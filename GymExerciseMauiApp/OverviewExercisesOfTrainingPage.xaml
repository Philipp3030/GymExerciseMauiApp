<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="GymExerciseMauiApp.OverviewExercisesOfTrainingPage"
             xmlns:viewmodel="clr-namespace:GymExerciseClassLibrary.ViewModels;assembly=GymExerciseClassLibrary"
             x:DataType="viewmodel:OverviewExercisesOfTrainingViewModel"
             Title="ExercisesOfTraining">

    <Grid RowDefinitions="Auto, Auto, Auto, *, Auto" ColumnDefinitions="Auto, *, Auto" BackgroundColor="#262626">
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Tapped="HideKeyboardAndUnfocus"/>
        </Grid.GestureRecognizers>
        
        <Entry x:Name="FocusStealer"
                WidthRequest="100" HeightRequest="10"
                Opacity="0"
                BackgroundColor="Transparent"
                IsEnabled="False">
        </Entry>

        <Label  Text="{Binding Training.Name}"
                LineBreakMode="WordWrap"
                TextColor="#cfdccf"
                FontSize="30"
                FontAttributes="None"
                Margin="0,20,0,20"
                HorizontalOptions="Center"
                Grid.Row="0"
                Grid.ColumnSpan="3"/>

        <Button x:Name="TimeLabelButton"
                Text="00:00.00"
                Clicked="OnStartClicked"
                IsEnabled="False"
                TextColor="Black"
                BorderColor="Black"
                BorderWidth="0.5"
                FontSize="20"
                BackgroundColor="Gray"
                WidthRequest="350"
                HeightRequest="50"
                CornerRadius="30"
                Margin="10,0,10,10"
                HorizontalOptions="Center"
                Grid.Row="1"
                Grid.ColumnSpan="3">
        </Button>

        <Button Text="Start"
                Clicked="OnStartClicked"
                TextColor="Black"
                BorderColor="Black"
                BorderWidth="0.5"
                FontSize="16"
                BackgroundColor="Gray"
                WidthRequest="100"
                HeightRequest="50"
                CornerRadius="30"
                Margin="10,0,0,0"
                Grid.Row="2"
                Grid.Column="0">
        </Button>

        <Button Text="Reset"
                Clicked="OnResetClicked"
                TextColor="Black"
                BorderColor="Black"
                BorderWidth="0.5"
                FontSize="16"
                BackgroundColor="#808080"
                WidthRequest="100"
                HeightRequest="50"
                CornerRadius="30"
                Grid.Row="2"
                Grid.Column="1">
        </Button>

        <Button Text="Reset    Status"
                Command="{Binding ResetStatusOfAllExercisesOfTrainingCommand}"
                Padding="0"
                LineBreakMode="WordWrap"
                TextColor="Black"
                BorderColor="Black"
                BorderWidth="0.5"
                FontSize="16"
                BackgroundColor="#808080"
                WidthRequest="100"
                HeightRequest="50"
                CornerRadius="30"
                Margin="0,0,10,0"
                Grid.Row="2"
                Grid.Column="2">
        </Button>

        <Grid Grid.Row="3" Grid.ColumnSpan="3" BackgroundColor="Transparent" Padding="20">
            <CollectionView ItemsSource="{Binding Training.ExercisesOfTraining}" x:Name="ExerciseCollectionView" Margin="0, 10, 0, 10">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodel:ExerciseViewModel">
                        <SwipeView>
                            <!--<SwipeView.GestureRecognizers>-->
                                <!--geht hiermit iwas?-->
                            <!--</SwipeView.GestureRecognizers>-->
                            <!--<SwipeView.RightItems>
                                <SwipeItems Mode="Execute" SwipeBehaviorOnInvoked="Close">
                                    <SwipeItem  BackgroundColor="Transparent"
                                                Invoked="OnSwipedFromTop"
                                                IsVisible="True">
                                    </SwipeItem>
                                </SwipeItems>
                            </SwipeView.RightItems>-->
                            <!--<SwipeView.LeftItems>
                                <SwipeItems Mode="Execute" SwipeBehaviorOnInvoked="Close">
                                    <SwipeItem  BackgroundColor="Transparent"
                                                Invoked="OnTopSwiped"
                                                IsVisible="True">
                                    </SwipeItem>
                                </SwipeItems>
                            </SwipeView.LeftItems>-->

                            <VerticalStackLayout Margin="0, 0, 0, 10" BackgroundColor="Transparent">
                                <Border Stroke="Black" StrokeThickness="0.5">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10"/>
                                    </Border.StrokeShape>
                                    <Grid BackgroundColor="{Binding Color}" AutomationId="ExerciseGrid">
                                        <Grid.RowDefinitions>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                        </Grid.RowDefinitions>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="HideKeyboardAndUnfocus"/>
                                        </Grid.GestureRecognizers>

                                        <!-- Header Area (Always Visible) -->
                                        <Grid BackgroundColor="Transparent" Padding="15" Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer 
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OverviewExercisesOfTrainingViewModel}}, Path=ToggleExpandCommand}"
                                                CommandParameter="{Binding .}"
                                                Tapped="HideKeyboardAndUnfocus"/>
                                            </Grid.GestureRecognizers>

                                            <ImageButton Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Source="icon_remove_minus.png" 
                                                         MaximumWidthRequest="40" MaximumHeightRequest="30" Margin="0, 0, 15, 0"
                                                         Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OverviewExercisesOfTrainingViewModel}}, Path=RemoveExerciseFromTrainingCommand}"
                                                         CommandParameter="{Binding .}">
                                            </ImageButton>

                                            <Label Text="{Binding Name}"
                                                   x:Name="NameLabel"
                                                   TextColor="Black"
                                                   FontAttributes="Bold"
                                                   FontSize="16"
                                                   BackgroundColor="Transparent"
                                                   Grid.Row="0"
                                                   Grid.Column="1">
                                            </Label>
                                            <Label Text="{Binding MachineName}"
                                                   x:Name="MachineLabel"
                                                   TextColor="Black"
                                                   FontAttributes="None"
                                                   FontSize="14"
                                                   BackgroundColor="Transparent"
                                                   Grid.Row="1"
                                                   Grid.Column="1">
                                            </Label>
                                        
                                            <Grid Grid.Column="3" Grid.Row="0" Grid.RowSpan="2" BackgroundColor="Transparent">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>

                                                <ImageButton Grid.Row="0" Grid.Column="0" Source="icon_checkmark.png" 
                                                             MaximumWidthRequest="40" MaximumHeightRequest="35" Background="Transparent"
                                                             Clicked="SetStatusOfExercise">
                                                </ImageButton>

                                                <ImageButton Grid.Row="0" Grid.Column="1" Source="icon_edit.png"
                                                             MaximumWidthRequest="40" MaximumHeightRequest="35"
                                                             BackgroundColor="Transparent" Clicked="NavigateToUpdateExercise">
                                                </ImageButton>

                                                <ImageButton Grid.Row="0" Grid.Column="2" Source="icon_delete.png" 
                                                             MaximumWidthRequest="40" MaximumHeightRequest="30"
                                                             Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OverviewExercisesOfTrainingViewModel}}, Path=DeleteExerciseCommand}"
                                                             CommandParameter="{Binding .}">
                                                </ImageButton>
                                            </Grid>                               
                                        </Grid>

                                        <!-- Expandable Area -->
                                        <VerticalStackLayout x:Name="ExpandableArea" 
                                                    BackgroundColor="Transparent" 
                                                    Padding="15"
                                                    IsVisible="{Binding IsExpanded}"
                                                    Spacing="10"
                                                    Grid.Row="1">

                                            <!-- Sets Section -->
                                            <Button Text="Add Set"
                                                        TextColor="Black"
                                                        BorderColor="Black"
                                                        BorderWidth="0.5"
                                                        CornerRadius="30"
                                                        BackgroundColor="Transparent"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OverviewExercisesOfTrainingViewModel}}, Path=AddSetCommand}"
                                                        CommandParameter="{Binding .}">
                                            </Button>

                                            <!-- Set Collection -->
                                            <CollectionView x:Name="SetsCollectionView" ItemsSource="{Binding Sets}">
                                                <CollectionView.ItemTemplate>
                                                    <DataTemplate x:DataType="viewmodel:SetViewModel">
                                                        <HorizontalStackLayout Spacing="10">
                                                            <ImageButton Source="icon_delete_x.png" 
                                                                         MaximumWidthRequest="40" 
                                                                         MaximumHeightRequest="30"
                                                                         Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OverviewExercisesOfTrainingViewModel}}, Path=DeleteSetCommand}"
                                                                         CommandParameter="{Binding .}">
                                                            </ImageButton>

                                                            
                                                            <Image Source="icon_weight.png" 
                                                                   WidthRequest="40" 
                                                                   HeightRequest="30">
                                                            </Image>
                                                            
                                                            <!-- Weight Input -->
                                                            <VerticalStackLayout>
                                                                <Entry  TextColor="Black"
                                                                        WidthRequest="75" 
                                                                        Placeholder="Weight" 
                                                                        Keyboard="Numeric"
                                                                        Text="{Binding Weight}" 
                                                                        HorizontalTextAlignment="Center"
                                                                        Focused="OnEntryFocused"
                                                                        Unfocused="OnEntryUnfocused"/>
                                                                <Label Text="{Binding ErrorMessageWeight}" TextColor="Red" IsVisible="True" />
                                                                <!--Location => decimal dots / commas-->
                                                            </VerticalStackLayout>

                                                            <Image Source="icon_reps.png" 
                                                                   WidthRequest="40" 
                                                                   HeightRequest="30">
                                                            </Image>
                                                            
                                                            <!-- Reps Input -->
                                                            <VerticalStackLayout>
                                                                <Entry  TextColor="Black"
                                                                        WidthRequest="50" 
                                                                        Placeholder="Reps" 
                                                                        Keyboard="Numeric"
                                                                        Text="{Binding Reps}" 
                                                                        HorizontalTextAlignment="Center"
                                                                        Focused="OnEntryFocused"
                                                                        Unfocused="OnEntryUnfocused">
                                                                </Entry>
                                                                <Label Text="{Binding ErrorMessageReps}" TextColor="Red" IsVisible="True" />
                                                            </VerticalStackLayout>
                                                        </HorizontalStackLayout>
                                                    </DataTemplate>
                                                </CollectionView.ItemTemplate>
                                            </CollectionView>

                                            <!-- Advanced Options Button -->
                                            <!--<Button Text="Advanced Options"
                                                    TextColor="Black"
                                                    BorderColor="Black"
                                                    BorderWidth="0.5"
                                                    CornerRadius="30"
                                                    BackgroundColor="Transparent"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:OverviewExercisesOfTrainingViewModel}}, Path=ToggleAdvancedOptionsCommand}"
                                                    CommandParameter="{Binding .}">
                                            </Button>-->

                                            <!-- Advanced Fields -->
                                            <!--<VerticalStackLayout Padding="20" Spacing="15">
                                                <Label x:Name="TimeLabel"
                                                       Text="00:00"
                                                       FontSize="36"
                                                       HorizontalOptions="Center" />
                                                <HorizontalStackLayout HorizontalOptions="Center" Spacing="10">
                                                    <Button Text="Start" 
                                                            Clicked="OnStartClicked" 
                                                            TextColor="Black"
                                                            BorderColor="Black"
                                                            BorderWidth="0.5"
                                                            CornerRadius="30"
                                                            BackgroundColor="Transparent">
                                                    </Button>
                                                    <Button Text="Stop" 
                                                            Clicked="OnStopClicked"         
                                                            TextColor="Black"
                                                            BorderColor="Black"
                                                            BorderWidth="0.5"
                                                            CornerRadius="30"
                                                            BackgroundColor="Transparent">
                                                    </Button>
                                                    <Button Text="Reset" 
                                                            Clicked="OnResetClicked"         
                                                            TextColor="Black"
                                                            BorderColor="Black"
                                                            BorderWidth="0.5"
                                                            CornerRadius="30"
                                                            BackgroundColor="Transparent">
                                                    </Button>
                                                </HorizontalStackLayout>
                                            </VerticalStackLayout>
                                            --><!--<VerticalStackLayout IsVisible="{Binding IsAdvancedOptionsClicked}">
                                                <Label Text="Maschine:" FontSize="14" />
                                                <Entry Text="{Binding MachineName}" 
                                                       FontSize="14"
                                                       Focused="OnEntryFocused"
                                                       Unfocused="OnEntryUnfocused"/>
                                            </VerticalStackLayout>-->
                                        </VerticalStackLayout>
                                    </Grid>
                                </Border>
                            </VerticalStackLayout>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>